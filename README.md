# Retro Shooter AI & Strategic System

This README summarizes the recent enhancements to the enemy AI, strategic patterns, and ability system in the retro shooter project.

## Key Features Implemented

1. **Dynamic Cover Generation**
   - `CoverFormation` now generates cover points every frame around the player (no longer tied to movement threshold).
   - `StrategicSystem` broadcasts updated points via `OnCoverPointsUpdated` event to `EnemyMovement2`.

2. **Strategic Tick Loop**
   - Central `StrategicSystem` drives AI decisions each frame: cover updates, intruder alerts, pattern triggers, and activation logic.
   - Deprecated per-enemy raycasts; AI subscribes to precomputed cover points.

3. **Ambush Pattern (L1AmbushPattern)**
   - Implemented `IBehaviorPattern` interface and `L1AmbushPattern`: L1Soldier pairs advance to random cover points, sit in ambush, then repeat.
   - Uses UniTask for asynchronous, cancelable pattern execution.

4. **Ability System (Grenade Throws & Future Drones)**
   - Mana-based ability for L1Soldier: regenerates from 0→100 over `manaRechargeTime` seconds.
   - Strategic loop (`GrenadeLoop`) checks every 2.5–5 s per soldier, with a configurable chance (`grenadeThrowChance`) to throw.
   - Throws occur only if player within `grenadeThrowDistance` meters.
   - Round-robin/random selection prevents the same soldier from throwing twice in a row.
   - `ThrowAbility` disables movement (`EnemyMovement2`) and shooting (`EnemyWeapon`), triggers a "Throw" animation, waits `grenadeThrowDelay` seconds, instantiates a grenade prefab (spawns from a child named `GrenadeSpawnPoint` if present), applies physics, then resumes AI.

5. **Visual Debugging**
   - `OnGUI` in `StrategicSystem` displays current `Mana`, `Reload rate`, and `Grenade cost` on-screen for rapid tuning.

## Unity Package & Dependencies

- **UniTask**: asynchronous toolset installed via OpenUPM registry (package `com.cysharp.unitask`).
- Ensure your **Package Manager → Project Settings → Scoped Registries** includes:
  ```json
  {
    "name": "openupm",
    "url": "https://package.openupm.com",
    "scopes": ["com.cysharp"]
  }
  ```
- Add `com.cysharp.unitask` version `2.3.3` under `Window → Package Manager`.

## Setup & Configuration

1. **StrategicSystem**
   - Attach `StrategicSystem` component to a central GameObject (e.g. `GameManager`).
   - Configure serialized fields:
     - Cover & pattern timing: `minPatternDelay`, `maxPatternDelay`, `ambushRadius`, `approachDistanceMin/Max`, `ambushWaitDuration`, `groupSpacingRadius`, `ambushGroupSize`.
     - Ability settings: assign a **grenadePrefab**, set `grenadeManaCost`, `manaRechargeTime`, `maxMana`, `grenadeThrowDelay`, `grenadeThrowChance`, `grenadeCheckIntervalMin/Max`, `grenadeThrowDistance`.

2. **L1Soldier Prefab**
   - Tag or name your AI units as **L1Soldier** (or prefix with "L1Soldier").
   - Add a child GameObject named `GrenadeSpawnPoint` at the desired throw origin.
   - Ensure components present: `EnemyMovement2`, `EnemyWeapon`, `LookRegistrator`, `NavMeshAgent`, `Animator` (with a `Throw` trigger).

3. **CoverFormation**
   - Place `CoverFormation` in the scene, assign the player `Transform` and `PlayerTargetSystem` reference.

4. **Testing & Playmode**
   - Run the scene; watch on-screen debug for Mana and throw events.
   - Verify that L1Soldier units alternate grenade throws, stop movement/shooting for the throw animation, then resume.

5. **PSOneShaderGI Parameter Auto-Apply**
   - Use the **Tools → Set PSOneShaderGI Params for Materials** window to adjust shader parameters (_Tiling, _PixelationAmount, _ColorPrecision, _JitterAmount, _TextureFPS, _TextureJitterAmplitude).
   - Settings are saved in `EditorPrefs` and now automatically applied to all materials when entering Play Mode, so manual application is no longer required.

## Next Steps

- Implement **drone ability** similar to grenade but with flight and delayed explosion.
- Add more **behavior patterns** for other enemy types.
- Polish AI transitions: between ambush, cover, chase, and retreat.
- Integrate weapon animations and visual effects for abilities.

---
*Generated by strategic AI assistant on your codebase.*